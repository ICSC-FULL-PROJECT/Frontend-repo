<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICSC 2026 - Partner Registration</title>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,400italic,700italic" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css">
    <style>
        :root {
            --primary-color: #28a745;
            --primary-dark: #218838;
            --secondary-color: #007bff;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --light-gray: #f8f9fa;
            --border-color: #e9ecef;
            --text-dark: #2c3e50;
            --text-light: #6c757d;
        }
        
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #ffffff;
            line-height: 1.6;
            color: var(--text-dark);
            margin: 0;
            padding: 0;
        }
        
        .site-background {
            background-color: #ffffff !important;
        }
        
        .navbar {
            background: white;
            border: none;
            margin-bottom: 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 0.5rem 0;
        }
        
        .jumbotron {
            background-color: #ffffff;
            margin-bottom: 0;
            padding: 30px 0;
        }
        
        .logo img {
            max-height: 80px;
            width: auto;
        }
        
        .progress-container {
            margin: 30px 0;
            position: relative;
            padding: 0 15px;
        }
        
        .progress-indicator.dots {
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 0 auto;
            width: 100%;
            max-width: 500px;
        }

        .progress-indicator.dots::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 2px;
            background: #ddd;
            transform: translateY(-50%);
            z-index: 1;
            border-radius: 2px;
        }

        .progress-line {
            position: absolute;
            top: 50%;
            left: 0;
            height: 2px;
            background: #008751;
            transform: translateY(-50%);
            border-radius: 2px;
            width: 0%;
            z-index: 2;
            transition: width 0.4s ease-in-out;
        }

        .progress-indicator.dots .dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: #ccc;
            position: relative;
            z-index: 3;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .progress-indicator.dots .dot.active {
            background-color: #008751;
            transform: scale(1.2);
        }

        .progress-indicator.dots .dot.completed {
            background-color: #4caf50;
        }
        
        .form-section {
            background: white;
            border-radius: 8px;
            padding: 25px 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            width: 100%;
        }
        
        .has-star::after {
            content: " *";
            color: var(--danger-color);
        }
        
        .btn-standard {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
            padding: 14px 25px;
            font-weight: bold;
            font-size: 1rem;
            border-radius: 8px;
            width: 100%;
            margin: 5px 0;
        }
        
        .btn-standard:hover {
            background-color: var(--primary-dark);
            border-color: var(--primary-dark);
            color: white;
        }
        
        .btn-outline-standard {
            background-color: transparent;
            border-color: var(--primary-color);
            color: var(--primary-color);
            padding: 14px 25px;
            font-weight: bold;
            border-radius: 8px;
            width: 100%;
            margin: 5px 0;
        }
        
        .btn-outline-standard:hover {
            background-color: var(--primary-color);
            color: white;
        }
        
        .social-media-links a {
            color: var(--primary-color) !important;
        }
        
        .footer-container {
            background-color: var(--light-gray);
            padding: 30px 0;
            margin-top: 40px;
        }
        
        .help-block-error {
            color: var(--danger-color);
            font-size: 0.8em;
            display: none;
            margin-top: 5px;
        }
        
        .hint-block {
            font-size: 0.8em;
            color: var(--text-light);
            margin-top: 5px;
        }
        
        .form-group {
            margin-bottom: 1.2rem;
            position: relative;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            border: 1px solid #f5c6cb;
            display: none;
            font-size: 0.9rem;
        }
        
        input.error, select.error, textarea.error {
            border-color: var(--danger-color);
        }
        
        .confirmation-details {
            background: var(--light-gray);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .confirmation-item {
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .confirmation-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .confirmation-label {
            font-weight: bold;
            color: #495057;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .confirmation-value {
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #c3e6cb;
            text-align: center;
            margin: 20px 0;
        }
        
        .package-cards {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        
        .package-card {
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .package-card:hover {
            border-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.1);
        }
        
        .package-card.selected {
            border-color: var(--primary-color);
            background: #f8fff9;
        }
        
        .package-card h4 {
            margin-bottom: 12px;
            color: var(--text-dark);
            text-align: center;
            font-size: 1.2rem;
        }
        
        .package-card .price {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--success-color);
            text-align: center;
            margin: 12px 0;
        }
        
        .package-card ul {
            padding-left: 18px;
            margin-bottom: 12px;
        }
        
        .package-card li {
            margin-bottom: 6px;
            color: var(--text-light);
            font-size: 0.85rem;
            line-height: 1.4;
        }
        
        .package-card .limited {
            color: var(--danger-color);
            font-weight: bold;
            text-align: center;
            margin-top: 8px;
            font-size: 0.8rem;
        }
        
        .payment-section {
            background: var(--light-gray);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .payment-option {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            background: white;
        }
        
        .payment-option.selected {
            border-color: var(--primary-color);
            background: #f8fff9;
        }
        
        .payment-option input {
            margin-right: 10px;
        }
        
        .payment-option label {
            margin-bottom: 0;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .payment-form {
            margin-top: 15px;
            display: none;
        }
        
        .iti {
            width: 100%;
        }
        
        .phone-input-container {
            position: relative;
        }
        
        .phone-input-container .form-control {
            padding-left: 52px;
        }
        
        .pdf-viewer {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 18px;
            margin: 18px 0;
            background: var(--light-gray);
        }
        
        .pdf-viewer h5 {
            margin-bottom: 12px;
            color: var(--text-dark);
            font-size: 1.1rem;
        }
        
        .pdf-placeholder {
            background: white;
            border-radius: 6px;
            padding: 30px 20px;
            text-align: center;
            border: 2px dashed var(--border-color);
        }
        
        .pdf-placeholder i {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 12px;
        }

        .sponsor-package-info {
            background: #f8f9fa;
            border-left: 4px solid var(--primary-color);
            padding: 18px;
            margin: 18px 0;
            border-radius: 4px;
        }

        .sponsor-package-info h5 {
            color: var(--primary-color);
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .password-toggle {
            position: absolute;
            right: 12px;
            top: 38px;
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            z-index: 10;
        }

        .password-toggle:focus {
            outline: none;
        }

        .button-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }

        .container {
            padding-left: 15px;
            padding-right: 15px;
            max-width: 100%;
        }

        /* Fix for button layout issue */
        .content-section .container {
            position: relative;
            z-index: 1;
        }

        .progress-container {
            z-index: 2;
        }

        .form-section {
            position: relative;
            z-index: 1;
        }

        @media (max-width: 768px) {
            .navbar-brand {
                font-size: 1rem;
            }
            
            .jumbotron h1 {
                font-size: 1.5rem;
            }
            
            .jumbotron .lead {
                font-size: 0.9rem;
            }
            
            .form-section {
                padding: 20px 15px;
            }
            
            .package-card {
                padding: 15px;
            }
            
            .confirmation-details, .payment-section {
                padding: 15px;
            }
            
            .pdf-viewer {
                padding: 15px;
            }
            
            .btn-standard, .btn-outline-standard {
                padding: 12px 20px;
                font-size: 0.95rem;
            }
        }

        @media (max-width: 576px) {
            .progress-indicator.dots {
                max-width: 100%;
            }
            
            .progress-indicator.dots .dot {
                width: 14px;
                height: 14px;
            }
            
            .package-card h4 {
                font-size: 1.1rem;
            }
            
            .success-message {
                padding: 15px;
            }
            
            .container {
                padding-left: 10px;
                padding-right: 10px;
            }
        }

        @media (min-width: 768px) {
            .package-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .form-row {
                grid-template-columns: 1fr 1fr;
            }
            
            .button-container {
                flex-direction: row;
                justify-content: space-between;
            }
            
            .btn-standard, .btn-outline-standard {
                width: auto;
                margin: 0;
            }
        }

        @media (min-width: 992px) {
            .package-cards {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (hover: none) {
            .package-card:hover {
                transform: none;
                border-color: var(--border-color);
            }
            
            .package-card.selected {
                border-color: var(--primary-color);
                transform: scale(1.02);
            }
        }

        button:focus,
        input:focus,
        select:focus,
        textarea:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        .btn-loading {
            position: relative;
            color: transparent;
        }

        .btn-loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            left: 50%;
            margin-left: -10px;
            margin-top: -10px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-right-color: transparent;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body class="standard-page">
    <!-- Navigation -->
    <div id="nav-wrap">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container">
                <div class="d-flex align-items-center">
                    <div class="logo me-3">
                        <img src="icsc-logos.png" alt="ICSC 2026" class="img-fluid">
                    </div>
                    <span class="navbar-brand mb-0 h1"></span>
                </div>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item active">
                            <a class="nav-link" href="login.html">SIGN IN</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="agenda.html">AGENDA</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>

    <!-- Header -->
    <div id="header-wrap" class="jumbotron site-background">
        <div class="container">
            <div class="text-center">
                <h1>INTERNATIONAL CIVIL SERVICE CONFERENCE (ICSC) 2026</h1>
                <p class="lead">Building Global Civil Service Excellence</p>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="content-section">
        <div class="container">
            <!-- Progress Indicator (Dot Style) -->
            <div class="progress-container">
                <div class="progress-indicator dots" id="progress-indicator">
                    <span class="dot active" id="dot-1" title="Account Information"></span>
                    <span class="dot" id="dot-2" title="Profile Information"></span>
                    <span class="dot" id="dot-3" title="Package Selection"></span>
                    <span class="dot" id="dot-4" title="Payment"></span>
                    <span class="dot" id="dot-5" title="Confirmation"></span>
                    <div class="progress-line"></div>
                </div>
            </div>
            
            <div class="text-center mb-4">
                <p class="lead"><strong>To return to the International Civil Service Conference website please click <a href="Index.html" target="_blank">here</a>.</strong></p>
            </div>

            <!-- Step 1: Account Creation Section -->
            <div id="account-section" class="form-section">
                <h2 class="text-center mb-4">Create Your Account</h2>
                
                <form id="account-form">
                    <div class="form-group">
                        <label class="has-star" for="email">Email Address</label>
                        <input type="email" id="email" name="email" class="form-control" required>
                        <div class="help-block-error" id="email-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="has-star" for="password">Choose a Password</label>
                        <div class="position-relative">
                            <input type="password" id="password" name="password" class="form-control" required>
                            <button type="button" class="password-toggle" id="togglePassword">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="help-block-error" id="password-error"></div>
                        <div class="hint-block">Creating a password lets you log back in to modify your registration and access your dashboard</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="has-star" for="confirmPassword">Repeat Your Password</label>
                        <div class="position-relative">
                            <input type="password" id="confirmPassword" name="confirmPassword" class="form-control" required>
                            <button type="button" class="password-toggle" id="toggleConfirmPassword">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="help-block-error" id="confirmPassword-error"></div>
                    </div>
                </form>
                
                <div class="button-container">
                    <a href="register.html" class="btn btn-outline-standard">
                        <i class="fas fa-arrow-circle-left me-2"></i> Back to Registration Types
                    </a>
                    <button type="button" class="btn btn-standard" id="continue-to-profile-btn">
                        Continue <i class="fas fa-arrow-circle-right ms-2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 2: Profile Information Section -->
            <div id="profile-section" class="form-section" style="display: none;">
                <h2 class="text-center mb-4">Partner Profile Information</h2>
                
                <form id="profile-form">
                    <div class="form-group">
                        <label class="has-star" for="companyPrefix">Prefix</label>
                        <select id="companyPrefix" name="companyPrefix" class="form-control" required>
                            <option value="">Select Prefix</option>
                            <option value="company">Company</option>
                            <option value="organization">Organization</option>
                            <option value="institution">Institution</option>
                            <option value="agency">Agency</option>
                        </select>
                        <div class="help-block-error" id="companyPrefix-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="has-star" for="companyName">Company/Organization Name</label>
                        <input type="text" id="companyName" name="companyName" class="form-control" required>
                        <div class="help-block-error" id="companyName-error"></div>
                    </div>

                    <div class="form-group">
                        <label class="has-star" for="companyLogo">Company/Organization Logo</label>
                        <input type="file" id="companyLogo" name="companyLogo" class="form-control" required>
                        <div class="help-block-error" id="companyLogo-error"></div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="has-star" for="contactFirstName">Contact First Name</label>
                            <input type="text" id="contactFirstName" name="contactFirstName" class="form-control" required>
                            <div class="help-block-error" id="contactFirstName-error"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="has-star" for="contactLastName">Contact Last Name</label>
                            <input type="text" id="contactLastName" name="contactLastName" class="form-control" required>
                            <div class="help-block-error" id="contactLastName-error"></div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="has-star" for="contactEmail">Contact Email</label>
                        <input type="email" id="contactEmail" name="contactEmail" class="form-control" required>
                        <div class="help-block-error" id="contactEmail-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="has-star" for="contactPhone">Contact Phone</label>
                        <div class="phone-input-container">
                            <input type="tel" id="contactPhone" name="contactPhone" class="form-control" required>
                        </div>
                        <div class="help-block-error" id="contactPhone-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="website">Website</label>
                        <input type="url" id="website" name="website" class="form-control" placeholder="https://">
                    </div>
                    
                    <div class="form-group">
                        <label for="socialMedia">Social Media Handles</label>
                        <input type="text" id="socialMedia" name="socialMedia" class="form-control" placeholder="e.g., @companyname">
                    </div>
                    
                    <div class="form-group">
                        <label for="partnerDescription">Company/Organization Description</label>
                        <textarea id="partnerDescription" name="partnerDescription" class="form-control" rows="4" placeholder="Please describe your company/organization and its mission"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="partnerInterest">Why are you interested in partnering with ICSC 2026?</label>
                        <textarea id="partnerInterest" name="partnerInterest" class="form-control" rows="3" placeholder="Please explain your interest in partnering with the conference"></textarea>
                    </div>
                </form>
                
                <div class="button-container">
                    <button type="button" class="btn btn-outline-standard" id="back-to-account-btn">
                        <i class="fas fa-arrow-circle-left me-2"></i> Back
                    </button>
                    <button type="button" class="btn btn-standard" id="continue-to-package-btn">
                        Continue <i class="fas fa-arrow-circle-right ms-2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 3: Package Selection Section -->
            <div id="package-section" class="form-section" style="display: none;">
                <h2 class="text-center mb-4">Select Your Partnership Package</h2>
                
                <!-- PDF Viewer for Partner -->
                <div class="sponsor-package-info">
                    <h5><i class="fas fa-file-pdf me-2"></i>Partnership Package Information</h5>
                    <p>Please review the partnership package details in the document below before making your selection.</p>
                    <div class="pdf-viewer">
                        <h5>ICSC Partnership Packages</h5>
                        <div class="pdf-placeholder">
                            <i class="fas fa-file-pdf"></i>
                            <p>ICSC_Partnership_Packages.pdf</p>
                            <p class="text-muted">This document contains detailed information about partnership packages and benefits.</p>
                            <button type="button" class="btn btn-outline-primary mt-2" onclick="viewPartnerPackagePDF()">
                                <i class="fas fa-eye me-2"></i>View PDF
                            </button>
                            <button type="button" class="btn btn-outline-secondary mt-2" onclick="downloadPartnerPackagePDF()">
                                <i class="fas fa-download me-2"></i>Download PDF
                            </button>
                        </div>
                    </div>
                </div>
                
                <p class="text-center mb-4">Choose the partnership package that best fits your organization's goals</p>
                
                <div class="package-cards">
                    <div class="package-card" data-package="bronze-partner">
                        <h4>Bronze Partner</h4>
                        <div class="price">N5,000</div>
                        <ul>
                            <li>Logo on conference website</li>
                            <li>Logo in conference program</li>
                            <li>Social media mention</li>
                            <li>1 complimentary registration</li>
                            <li>Exhibition booth (3x3m)</li>
                        </ul>
                        <div class="limited">Limited availability</div>
                    </div>
                    
                    <div class="package-card" data-package="silver-partner">
                        <h4>Silver Partner</h4>
                        <div class="price">N10,000</div>
                        <ul>
                            <li>All Bronze benefits</li>
                            <li>Larger logo placement</li>
                            <li>Dedicated social media posts</li>
                            <li>2 complimentary registrations</li>
                            <li>Exhibition booth (3x6m)</li>
                            <li>Recognition during opening ceremony</li>
                        </ul>
                        <div class="limited">Limited availability</div>
                    </div>
                    
                    <div class="package-card" data-package="gold-partner">
                        <h4>Gold Partner</h4>
                        <div class="price">N15,000</div>
                        <ul>
                            <li>All Silver benefits</li>
                            <li>Prominent logo placement</li>
                            <li>Featured in pre-conference communications</li>
                            <li>4 complimentary registrations</li>
                            <li>Premium exhibition booth (6x6m)</li>
                            <li>Speaking opportunity at a breakout session</li>
                            <li>Recognition during opening and closing ceremonies</li>
                        </ul>
                        <div class="limited">Very limited availability</div>
                    </div>
                    
                    <div class="package-card" data-package="platinum-partner">
                        <h4>Platinum Partner</h4>
                        <div class="price">N30,000</div>
                        <ul>
                            <li>All Gold benefits</li>
                            <li>Exclusive logo placement</li>
                            <li>Keynote speaking opportunity</li>
                            <li>8 complimentary registrations</li>
                            <li>Custom exhibition space</li>
                            <li>Dedicated press release</li>
                            <li>Branding at VIP reception</li>
                            <li>Private meeting with conference organizers</li>
                        </ul>
                        <div class="limited">Only 2 slots available</div>
                    </div>
                </div>
                
                <div class="button-container">
                    <button type="button" class="btn btn-outline-standard" id="back-to-profile-btn">
                        <i class="fas fa-arrow-circle-left me-2"></i> Back
                    </button>
                    <button type="button" class="btn btn-standard" id="continue-to-payment-btn" disabled>
                        Continue <i class="fas fa-arrow-circle-right ms-2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 4: Payment Section -->
            <div id="payment-section" class="form-section" style="display: none;">
                <h2 class="text-center mb-4">Payment Information</h2>
                
                <div class="payment-section">
                    <div class="form-group">
                        <label class="has-star">Select Payment Method</label>
                        <div class="payment-option">
                            <input type="radio" id="bank-transfer" name="payment-method" value="bank-transfer">
                            <label for="bank-transfer">Bank Transfer</label>
                        </div>
                        <div class="payment-option">
                            <input type="radio" id="flutterwave" name="payment-method" value="flutterwave">
                            <label for="flutterwave">Flutterwave (Online Payment)</label>
                        </div>
                    </div>
                    
                    <div class="payment-form" id="bank-transfer-form">
                        <h5>Bank Transfer Details</h5>
                        <p><strong>Bank Name:</strong> First Bank Nigeria</p>
                        <p><strong>Account Name:</strong> ICSC 2026 Conference</p>
                        <p><strong>Account Number:</strong> 1234567890</p>
                        <p><strong>Sort Code:</strong> 123456</p>
                        <p>Please include your registration ID as the payment reference.</p>
                        
                        <!-- Payment Receipt Upload - Only for Bank Transfer -->
                        <div class="form-group mt-4">
                            <label class="has-star" for="paymentReceipt">Upload Payment Receipt</label>
                            <input type="file" id="paymentReceipt" name="paymentReceipt" class="form-control" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx">
                            <div class="help-block-error" id="paymentReceipt-error"></div>
                            <div class="hint-block">Accepted formats: PDF, JPG, PNG, DOC (Max size: 5MB)</div>
                        </div>
                    </div>
                    
                    <div class="payment-form" id="flutterwave-form">
                        <h5>Flutterwave Payment</h5>
                        <p>You will be redirected to Flutterwave's secure payment gateway to complete your transaction.</p>
                        <p>Accepted payment methods:</p>
                        <ul>
                            <li>Visa/Mastercard</li>
                            <li>Bank Transfer</li>
                            <li>USSD</li>
                            <li>Mobile Money</li>
                        </ul>
                        <button type="button" class="btn btn-standard" id="pay-with-flutterwave">
                            <i class="fas fa-credit-card me-2"></i>Pay with Flutterwave
                        </button>
                    </div>
                </div>
                
                <div class="button-container">
                    <button type="button" class="btn btn-outline-standard" id="back-to-package-btn">
                        <i class="fas fa-arrow-circle-left me-2"></i> Back
                    </button>
                    <button type="button" class="btn btn-standard" id="complete-registration-btn" disabled>
                        Complete Registration
                    </button>
                </div>
            </div>

            <!-- Step 5: Confirmation Section -->
            <div id="confirmation-section" class="form-section" style="display: none;">
                <h2 class="text-center mb-4">Registration Confirmation</h2>
                
                <div class="success-message">
                    <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                    <h3>Registration Successful!</h3>
                    <p class="mb-0">Thank you for registering as a Partner for the International Civil Service Conference 2026.</p>
                </div>
                
                <div class="confirmation-details">
                    <h4 class="mb-3">Registration Details</h4>
                    <div class="confirmation-item">
                        <div class="confirmation-label">Registration ID</div>
                        <div class="confirmation-value" id="confirmation-id">ICSC2026-001234</div>
                    </div>
                    <div class="confirmation-item">
                        <div class="confirmation-label">Registrant Type</div>
                        <div class="confirmation-value" id="confirmation-type">Partner</div>
                    </div>
                    <div class="confirmation-item">
                        <div class="confirmation-label">Name</div>
                        <div class="confirmation-value" id="confirmation-name">John Doe</div>
                    </div>
                    <div class="confirmation-item">
                        <div class="confirmation-label">Email</div>
                        <div class="confirmation-value" id="confirmation-email">john.doe@example.com</div>
                    </div>
                    <div class="confirmation-item">
                        <div class="confirmation-label">Selected Package</div>
                        <div class="confirmation-value" id="confirmation-package">Basic Partner Package</div>
                    </div>
                    <div class="confirmation-item">
                        <div class="confirmation-label">Payment Status</div>
                        <div class="confirmation-value" id="confirmation-payment">Pending</div>
                    </div>
                </div>
                
                <div class="text-center mt-4">
                    <p>A confirmation email has been sent to <strong id="confirmation-email-text">john.doe@example.com</strong> with all the details.</p>
                    <div class="button-container">
                        <button type="button" class="btn btn-standard" id="go-to-dashboard-btn">
                            Go to Dashboard
                        </button>
                        <a href="Index.html" class="btn btn-outline-standard">Return to Conference Website</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer-container">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>INTERNATIONAL CIVIL SERVICE CONFERENCE (ICSC) 2026</h5>
                    <p>Building Global Civil Service Excellence</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <h5>Contact Us</h5>
                    <p>Email: info@icsc2026.org</p>
                    <p>Phone: +1 (555) 123-4567</p>
                    <div class="social-media-links mt-3">
                        <a href="#" class="me-3"><i class="fab fa-twitter fa-lg"></i></a>
                        <a href="#" class="me-3"><i class="fab fa-linkedin fa-lg"></i></a>
                        <a href="#" class="me-3"><i class="fab fa-facebook fa-lg"></i></a>
                    </div>
                </div>
            </div>
            <div class="row mt-4">
                <div class="col-12 text-center">
                    <p class="mb-0">&copy; 2026 International Civil Service Conference. All rights reserved.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://checkout.flutterwave.com/v3.js"></script>
    <script src="js/apiClient.js"></script>
    <script src="js/auth.js"></script>

    <!-- Main Application Script -->
    <script>
        // Global variables for partner registration
        let currentStep = 1;
        const selectedRegistrantType = 'partner';
        let selectedPackage = '';
        let selectedPackageId = null;
        let selectedPaymentMethod = '';
        let phoneInputs = [];
        let uploadedLogoUrl = ''; // holds the uploaded company logo URL returned by /misc/upload-image
        let lastPartnerRegistrationResponse = null;
        let availablePackages = [];
        
        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            try {
                // Fetch packages from backend and render them
                await fetchAndRenderPackages();

                // Initialize phone inputs
                initializePhoneInputs();

                // Set up event listeners
                setupEventListeners();

                // Update progress indicator
                updateProgressIndicator();

                // Setup package selection (after dynamic rendering)
                setupPackageSelection();

                // Setup payment section
                setupPaymentSection();
            } catch (error) {
                console.error('Error initializing app:', error);
            }
        }

        // Fetch partner packages from backend and render into the .package-cards container
        async function fetchAndRenderPackages() {
            const container = document.querySelector('.package-cards');
            if (!container) return;

            // Show loading placeholder
            container.innerHTML = '<div class="package-card"><h4>Loading packages...</h4></div>';

            if (!window.apiClient || !window.apiClient.get) {
                console.warn('apiClient not available - using existing static packages');
                return;
            }

            try {
                const resp = await window.apiClient.get('/packages/event-partner-packages');
                const respData = resp && (resp.data || resp);
                let packages = respData && (respData.data || respData);

                if (!Array.isArray(packages)) {
                    console.warn('Unexpected packages response shape, expected array:', packages);
                    packages = [];
                }

                // Clear container and render fetched packages
                container.innerHTML = '';

                if (packages.length === 0) {
                    container.innerHTML = '<div class="package-card"><h4>No packages available at the moment</h4></div>';
                    return;
                }

                packages.forEach(pkg => {
                    const card = document.createElement('div');
                    card.className = 'package-card';
                    card.setAttribute('data-package', pkg.slug || pkg.id || 'package-' + (pkg.id || Math.random()));
                    if (pkg.id) card.setAttribute('data-package-id', String(pkg.id));
                    availablePackages.push(pkg);

                    // price formatting
                    const price = typeof pkg.price === 'number' ? pkg.price : Number(pkg.price) || 0;
                    const priceText = price.toLocaleString();

                    const featuresHtml = Array.isArray(pkg.features) && pkg.features.length > 0
                        ? '<ul>' + pkg.features.map(f => `<li>${f}</li>`).join('') + '</ul>'
                        : '';

                    const limitedText = pkg.limitedText ? `<div class="limited">${pkg.limitedText}</div>` : '';

                    card.innerHTML = `
                        <h4>${pkg.title || pkg.slug}</h4>
                        <div class="price">N${priceText}</div>
                        ${featuresHtml}
                        ${limitedText}
                    `;

                    container.appendChild(card);
                });

            } catch (err) {
                console.error('Failed to fetch partner packages:', err);
                container.innerHTML = '<div class="package-card"><h4>Failed to load packages</h4><p>Please try again later.</p></div>';
            }
        }
        
        function initializePhoneInputs() {
            const phoneInputIds = ['contactPhone'];
            
            phoneInputs = phoneInputs || [];
            
            phoneInputIds.forEach(id => {
                const input = document.getElementById(id);
                if (input && window.intlTelInput) {
                    try {
                        const iti = window.intlTelInput(input, {
                            initialCountry: "ng",
                            separateDialCode: true,
                            utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js"
                        });
                        phoneInputs.push({ id, iti });
                    } catch (error) {
                        console.error(`Error initializing phone input ${id}:`, error);
                    }
                }
            });
        }
        
        function setupEventListeners() {
            // Password toggle functionality
            const togglePassword = document.getElementById('togglePassword');
            const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            
            if (togglePassword && passwordInput) {
                togglePassword.addEventListener('click', function() {
                    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    passwordInput.setAttribute('type', type);
                    this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
                });
            }
            
            if (toggleConfirmPassword && confirmPasswordInput) {
                toggleConfirmPassword.addEventListener('click', function() {
                    const type = confirmPasswordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    confirmPasswordInput.setAttribute('type', type);
                    this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
                });
            }
            
            // Navigation buttons
            const continueToProfileBtn = document.getElementById('continue-to-profile-btn');
            if (continueToProfileBtn) {
                continueToProfileBtn.addEventListener('click', function() {
                    if (validateAccountForm()) {
                        showStep(2);
                    }
                });
            }
            
            const backToAccountBtn = document.getElementById('back-to-account-btn');
            if (backToAccountBtn) {
                backToAccountBtn.addEventListener('click', function() {
                    showStep(1);
                });
            }
            
            const continueToPackageBtn = document.getElementById('continue-to-package-btn');
            if (continueToPackageBtn) {
                continueToPackageBtn.addEventListener('click', function() {
                    if (validateProfileForm()) {
                        showStep(3);
                    }
                });
            }
            
            const backToProfileBtn = document.getElementById('back-to-profile-btn');
            if (backToProfileBtn) {
                backToProfileBtn.addEventListener('click', function() {
                    showStep(2);
                });
            }
            
            const continueToPaymentBtn = document.getElementById('continue-to-payment-btn');
            if (continueToPaymentBtn) {
                continueToPaymentBtn.addEventListener('click', async function() {
                    if (!validatePackageSelection()) return;

                    // Attempt to create event partner on continue
                    try {
                        // disable button to prevent double submits
                        continueToPaymentBtn.disabled = true;
                        await registerEventPartnerOnPackageSelect();

                        // proceed to payment step on success
                        showStep(4);
                    } catch (err) {
                        console.error('Failed to register event partner before payment:', err);
                        alert('Failed to create partner record. Please check your details and try again.');
                    } finally {
                        continueToPaymentBtn.disabled = false;
                    }
                });
            }
            
            const backToPackageBtn = document.getElementById('back-to-package-btn');
            if (backToPackageBtn) {
                backToPackageBtn.addEventListener('click', function() {
                    showStep(3);
                });
            }
            
            const completeRegistrationBtn = document.getElementById('complete-registration-btn');
            if (completeRegistrationBtn) {
                completeRegistrationBtn.addEventListener('click', function() {
                    if (validatePaymentForm()) {
                        processRegistration();
                    }
                });
            }
            
            // Flutterwave payment button
            const flutterwaveBtn = document.getElementById('pay-with-flutterwave');
            if (flutterwaveBtn) {
                flutterwaveBtn.addEventListener('click', function() {
                    processFlutterwavePayment();
                });
            }
            
            // Dashboard button
            const goToDashboardBtn = document.getElementById('go-to-dashboard-btn');
            if (goToDashboardBtn) {
                goToDashboardBtn.addEventListener('click', function() {
                    redirectToDashboard();
                });
            }

            // Upload company logo immediately when selected
            const companyLogoInput = document.getElementById('companyLogo');
            if (companyLogoInput) {
                companyLogoInput.addEventListener('change', async function (ev) {
                    const file = this.files && this.files[0];
                    if (!file) return;

                    // show simple feedback
                    const errElId = 'companyLogo-error';
                    hideError(errElId);

                    try {
                        if (!window.apiClient) throw new Error('API client not available');

                        const fd = new FormData();
                        // backend expects the uploaded file under the key 'company_logo'
                        fd.append('company_logo', file);

                        // POST to /misc/upload-image using apiClient base url
                        const resp = await window.apiClient.post('/misc/upload-image', fd, {
                            headers: { 'Content-Type': 'multipart/form-data' }
                        });

                        // extract image url from common response shapes
                        const data = resp && (resp.data || resp);
                        const imageUrl = (data && (data.image_url || data.url || data.data?.image_url || data.data?.url)) || null;
                        if (!imageUrl) {
                            // sometimes API returns the url directly as string
                            if (typeof data === 'string') uploadedLogoUrl = data;
                            else throw new Error('Could not determine uploaded image URL from response');
                        } else {
                            uploadedLogoUrl = imageUrl;
                        }

                        // simple success feedback: show filename in UI (reuse hint-block or error element)
                        const hintEl = document.createElement('div');
                        hintEl.className = 'hint-block';
                        hintEl.id = 'companyLogo-uploaded-hint';
                        hintEl.textContent = `Uploaded: ${uploadedLogoUrl}`;
                        // remove existing hint if present
                        const existing = document.getElementById('companyLogo-uploaded-hint');
                        if (existing) existing.remove();
                        companyLogoInput.parentNode.appendChild(hintEl);

                        console.log('Company logo uploaded:', uploadedLogoUrl);
                    } catch (err) {
                        console.error('Logo upload failed', err);
                        showError('companyLogo-error', err?.message || 'Image upload failed');
                        uploadedLogoUrl = '';
                    }
                });
            }
        }
        
        function setupPackageSelection() {
            const packageCards = document.querySelectorAll('.package-card');
            packageCards.forEach(card => {
                card.addEventListener('click', function() {
                    // Remove selected class from all cards
                    packageCards.forEach(c => c.classList.remove('selected'));
                    
                    // Add selected class to clicked card
                    this.classList.add('selected');
                    
                    // Store selected package (slug) and id
                    selectedPackage = this.getAttribute('data-package');
                    const pkgIdAttr = this.getAttribute('data-package-id');
                    selectedPackageId = pkgIdAttr ? Number(pkgIdAttr) : null;
                    
                    // Enable continue button
                    const continueBtn = document.getElementById('continue-to-payment-btn');
                    if (continueBtn) {
                        continueBtn.disabled = false;
                    }
                });
            });
        }

        async function registerEventPartnerOnPackageSelect() {
            try {
                // Basic validation - ensure required profile fields exist
                const companyPrefix = document.getElementById('companyPrefix')?.value || '';
                const companyName = document.getElementById('companyName')?.value || '';
                const contactFirstName = document.getElementById('contactFirstName')?.value || '';
                const contactLastName = document.getElementById('contactLastName')?.value || '';
                const contactEmail = document.getElementById('contactEmail')?.value || '';
                const contactPhone = document.getElementById('contactPhone')?.value || '';
                const website = document.getElementById('website')?.value || '';
                const socialMedia = document.getElementById('socialMedia')?.value || '';
                const partnerDescription = document.getElementById('partnerDescription')?.value || '';
                const partnerInterest = document.getElementById('partnerInterest')?.value || '';
                const password = document.getElementById('password')?.value || '';

                // Ensure logo is uploaded or attempt to upload now if file is present
                if (!uploadedLogoUrl) {
                    const logoInput = document.getElementById('companyLogo');
                    const file = logoInput && logoInput.files && logoInput.files[0];
                    if (file) {
                        // try uploading synchronously
                        const fd = new FormData();
                        // backend expects the uploaded file under the key 'company_logo'
                        fd.append('company_logo', file);
                        if (!window.apiClient) throw new Error('API client not available');
                        const resp = await window.apiClient.post('/misc/upload-image', fd, {
                            headers: { 'Content-Type': 'multipart/form-data' }
                        });
                        const data = resp && (resp.data || resp);
                        uploadedLogoUrl = (data && (data.image_url || data.url || data.data?.image_url || data.data?.url)) || uploadedLogoUrl;
                    }
                }

                // build payload according to sample
                const payload = {
                    companyPrefix: companyPrefix,
                    companyName: companyName,
                    companyLogo: uploadedLogoUrl || '',
                    contactFirstName: contactFirstName,
                    contactLastName: contactLastName,
                    contactEmail: contactEmail,
                    contactPhone: contactPhone,
                    website: website,
                    socialMedia: socialMedia,
                    partnerDescription: partnerDescription,
                    partnerInterest: partnerInterest,
                    password: password,
                    selectedPackage: selectedPackage
                };

                if (!window.apiClient) throw new Error('API client not available');

                // POST to /auth/event-partner-register
                const res = await window.apiClient.post('/auth/event-partner-register', payload);
                const resData = res && (res.data || res);
                lastPartnerRegistrationResponse = resData;

                // If backend returned an auth token, store it so subsequent authenticated calls work
                try {
                    const token = resData?.data?.token || resData?.token || resData?.accessToken || resData?.data?.accessToken;
                    if (token) {
                        // prefer storing under authUser as an object (apiClient reads this)
                        localStorage.setItem('authUser', JSON.stringify({ token }));
                        // also set legacy key
                        localStorage.setItem('accessToken', token);
                    }
                } catch (e) {
                    // ignore storage errors
                }

                // Simple success feedback
                alert('Partner registration (event) submitted successfully.');

                // optionally update confirmation id if present in response
                try {
                    const reference = resData?.reference || resData?.registrationId || resData?.id || resData?.data?.reference;
                    if (reference) {
                        const confirmationIdEl = document.getElementById('confirmation-id');
                        if (confirmationIdEl) confirmationIdEl.textContent = reference;
                    }
                } catch (e) { /* ignore */ }

                return resData;
            } catch (err) {
                console.error('Error registering event partner:', err);
                const message = err?.message || err?.response?.data?.message || 'Registration failed';
                alert('Event partner registration failed: ' + message);
                throw err;
            }
        }
        
        function setupPaymentSection() {
            const paymentOptions = document.querySelectorAll('.payment-option input');
            paymentOptions.forEach(option => {
                option.addEventListener('change', function() {
                    if (this.checked) {
                        selectedPaymentMethod = this.value;
                        // Show/hide payment forms based on selection
                        const paymentForms = document.querySelectorAll('.payment-form');
                        paymentForms.forEach(form => form.style.display = 'none');
                        
                        if (this.value === 'bank-transfer') {
                            const bankForm = document.getElementById('bank-transfer-form');
                            if (bankForm) bankForm.style.display = 'block';
                        } else if (this.value === 'flutterwave') {
                            const flutterwaveForm = document.getElementById('flutterwave-form');
                            if (flutterwaveForm) flutterwaveForm.style.display = 'block';
                        }
                        
                        // Enable complete registration button
                        const completeBtn = document.getElementById('complete-registration-btn');
                        if (completeBtn) {
                            completeBtn.disabled = false;
                        }
                    }
                });
            });
        }
        
        function validateAccountForm() {
            let isValid = true;
            
            // Email validation
            const email = document.getElementById('email').value;
            if (!email || !isValidEmail(email)) {
                showError('email-error', 'Please enter a valid email address');
                isValid = false;
            } else {
                hideError('email-error');
            }
            
            // Password validation
            const password = document.getElementById('password').value;
            if (!password || password.length < 8) {
                showError('password-error', 'Password must be at least 8 characters long');
                isValid = false;
            } else {
                hideError('password-error');
            }
            
            // Confirm password validation
            const confirmPassword = document.getElementById('confirmPassword').value;
            if (!confirmPassword || password !== confirmPassword) {
                showError('confirmPassword-error', 'Passwords do not match');
                isValid = false;
            } else {
                hideError('confirmPassword-error');
            }
            
            return isValid;
        }
        
        function validateProfileForm() {
            let isValid = true;
            
            const requiredFields = [
                'companyPrefix', 'companyName', 'companyLogo', 'contactFirstName', 
                'contactLastName', 'contactEmail', 'contactPhone'
            ];
            
            requiredFields.forEach(field => {
                const element = document.getElementById(field);
                if (!element || !element.value) {
                    showError(`${field}-error`, 'This field is required');
                    isValid = false;
                } else {
                    hideError(`${field}-error`);
                }
            });
            
            // Email validation for contact email
            const contactEmail = document.getElementById('contactEmail').value;
            if (contactEmail && !isValidEmail(contactEmail)) {
                showError('contactEmail-error', 'Please enter a valid email address');
                isValid = false;
            }
            
            return isValid;
        }
        
        function validatePackageSelection() {
            if (!selectedPackage) {
                alert('Please select a partnership package');
                return false;
            }
            return true;
        }
        
        function validatePaymentForm() {
            if (!selectedPaymentMethod) {
                alert('Please select a payment method');
                return false;
            }
            
            // Validate bank transfer receipt upload - ONLY for bank transfers
            if (selectedPaymentMethod === 'bank-transfer') {
                const paymentReceipt = document.getElementById('paymentReceipt');
                if (!paymentReceipt || !paymentReceipt.files || paymentReceipt.files.length === 0) {
                    showError('paymentReceipt-error', 'Please upload your payment receipt');
                    return false;
                }
                
                // Validate file size (5MB max)
                const file = paymentReceipt.files[0];
                const maxSize = 5 * 1024 * 1024; // 5MB in bytes
                if (file.size > maxSize) {
                    showError('paymentReceipt-error', 'File size must be less than 5MB');
                    return false;
                }
                
                // Validate file type
                const allowedTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
                if (!allowedTypes.includes(file.type)) {
                    showError('paymentReceipt-error', 'Please upload a valid file type (PDF, JPG, PNG, DOC)');
                    return false;
                }
                
                hideError('paymentReceipt-error');
            }
            
            return true;
        }
        
        async function processFlutterwavePayment() {
            try {
                // Ensure a package is selected
                if (!selectedPackageId) {
                    alert('Please select a package before proceeding to payment.');
                    return;
                }

                // Ensure API client is available
                if (!window.apiClient) throw new Error('API client not available');

                // Ensure auth token is present; try to recover from last partner response if missing
                try {
                    const raw = localStorage.getItem('authUser');
                    const auth = raw ? JSON.parse(raw) : null;
                    if (!auth || !auth.token) {
                        const tokenFromResp = lastPartnerRegistrationResponse?.data?.token || lastPartnerRegistrationResponse?.token || lastPartnerRegistrationResponse?.accessToken;
                        if (tokenFromResp) {
                            localStorage.setItem('authUser', JSON.stringify({ token: tokenFromResp }));
                            localStorage.setItem('accessToken', tokenFromResp);
                        }
                    }
                } catch (e) {
                    // ignore
                }

                // Determine amount from availablePackages if present
                let amount = 0;
                try {
                    const pkg = availablePackages.find(p => Number(p.id) === Number(selectedPackageId));
                    if (pkg && (pkg.price || pkg.price === 0)) amount = Number(pkg.price);
                } catch (e) {}

                // fallback mapping
                if (!amount) {
                    const packagePrices = {
                        'bronze-partner': 5000,
                        'silver-partner': 10000,
                        'gold-partner': 15000,
                        'platinum-partner': 30000
                    };
                    amount = packagePrices[selectedPackage] || 0;
                }

                const payload = {
                    event_package_id: selectedPackageId,
                    amount: amount,
                    currency: 'NGN',
                    tx_ref: 'ICSC-' + Date.now()
                };

                // Call initialize endpoint
                const resp = await window.apiClient.post('/payments/initialize-event-partner-payment', payload);
                const data = resp && (resp.data || resp);

                // extract hosted link from response
                const hostedLink = data?.data?.data?.link || data?.data?.link || data?.link;
                if (!hostedLink) {
                    throw new Error('Payment link not returned by server');
                }

                // Redirect the user to the hosted payment link
                window.location.href = hostedLink;
            } catch (err) {
                console.error('Flutterwave payment initialization failed', err);
                const message = err?.message || err?.response?.data?.message || 'Could not initialize payment';
                alert(message);
            }
        }
        
        async function processRegistration() {
            const completeBtn = document.getElementById('complete-registration-btn');
            
            if (completeBtn) {
                completeBtn.classList.add('btn-loading');
                completeBtn.disabled = true;
            }
            
            try {
                // REPLACE THIS WITH YOUR ACTUAL API CALL:
                if (!window.RegisterAPI) throw new Error('RegisterAPI not available.');
                
                const payload = {
                    company_prefix: document.getElementById('companyPrefix')?.value || '',
                    company_name: document.getElementById('companyName')?.value || '',
                    contact_first_name: document.getElementById('contactFirstName')?.value || '',
                    contact_last_name: document.getElementById('contactLastName')?.value || '',
                    contact_email: document.getElementById('contactEmail')?.value || '',
                    contact_phone: document.getElementById('contactPhone')?.value || '',
                    website: document.getElementById('website')?.value || '',
                    social_media: document.getElementById('socialMedia')?.value || '',
                    description: document.getElementById('partnerDescription')?.value || '',
                    partnership_interest: document.getElementById('partnerInterest')?.value || '',
                    partnership_package: selectedPackage,
                    payment_method: selectedPaymentMethod,
                    email: document.getElementById('email')?.value || '',
                    password: document.getElementById('password')?.value || ''
                };
                
                // Add payment receipt file if bank transfer was selected
                if (selectedPaymentMethod === 'bank-transfer') {
                    const paymentReceipt = document.getElementById('paymentReceipt');
                    if (paymentReceipt && paymentReceipt.files && paymentReceipt.files[0]) {
                        // For file uploads, you might need to use FormData instead of JSON
                        const formData = new FormData();
                        
                        // Append all form data
                        Object.keys(payload).forEach(key => {
                            formData.append(key, payload[key]);
                        });
                        
                        // Append the file
                        formData.append('payment_receipt', paymentReceipt.files[0]);
                        
                        // Use formData for the API call instead of payload
                        const responseData = await window.RegisterAPI.registerPartner(formData);
                        
                        // Update confirmation with response data
                        try {
                            const data = responseData.data || responseData;
                            const confirmationIdEl = document.getElementById('confirmation-id');
                            if (confirmationIdEl) confirmationIdEl.textContent = data.reference || data.registrationId || confirmationIdEl.textContent;
                        } catch (e) {}
                        
                        updateConfirmationSection();
                        showStep(5);
                        return;
                    }
                }
                
                // For Flutterwave payments or if no file upload needed
                const responseData = await window.RegisterAPI.registerPartner(payload);
                
                // Update confirmation with response data
                try {
                    const data = responseData.data || responseData;
                    const confirmationIdEl = document.getElementById('confirmation-id');
                    if (confirmationIdEl) confirmationIdEl.textContent = data.reference || data.registrationId || confirmationIdEl.textContent;
                } catch (e) {}
                
                updateConfirmationSection();
                showStep(5);
                
            } catch (err) {
                console.error('Registration failed', err);
                const message = err?.message || err?.response?.data?.message || 'Registration failed';
                alert(message);
            } finally {
                if (completeBtn) {
                    completeBtn.classList.remove('btn-loading');
                    completeBtn.disabled = false;
                }
            }
        }
        
        function updateConfirmationSection() {
            const email = document.getElementById('email')?.value || '';
            const contactEmail = document.getElementById('contactEmail')?.value || '';
            const contactFirstName = document.getElementById('contactFirstName')?.value || '';
            const contactLastName = document.getElementById('contactLastName')?.value || '';
            const companyName = document.getElementById('companyName')?.value || '';
            
            const confirmationEmail = document.getElementById('confirmation-email');
            const confirmationEmailText = document.getElementById('confirmation-email-text');
            const confirmationName = document.getElementById('confirmation-name');
            const confirmationType = document.getElementById('confirmation-type');
            const confirmationPackage = document.getElementById('confirmation-package');
            const confirmationPayment = document.getElementById('confirmation-payment');
            
            if (confirmationEmail) confirmationEmail.textContent = contactEmail || email;
            if (confirmationEmailText) confirmationEmailText.textContent = contactEmail || email;
            if (confirmationName) confirmationName.textContent = `${contactFirstName} ${contactLastName}`.trim() || companyName;
            if (confirmationType) confirmationType.textContent = 'Partner';
            if (confirmationPackage) {
                const packageNames = {
                    'bronze-partner': 'Bronze Partner',
                    'silver-partner': 'Silver Partner', 
                    'gold-partner': 'Gold Partner',
                    'platinum-partner': 'Platinum Partner'
                };
                confirmationPackage.textContent = packageNames[selectedPackage] || selectedPackage;
            }
            if (confirmationPayment) {
                const paymentMethods = {
                    'bank-transfer': 'Bank Transfer',
                    'flutterwave': 'Flutterwave'
                };
                confirmationPayment.textContent = paymentMethods[selectedPaymentMethod] || selectedPaymentMethod;
            }
        }
        
        function redirectToDashboard() {
            window.location.href = 'partner-dash.html';
        }
        
        function showStep(step) {
            const sections = ['account-section', 'profile-section', 'package-section', 'payment-section', 'confirmation-section'];
            
            sections.forEach(section => {
                const element = document.getElementById(section);
                if (element) {
                    element.style.display = 'none';
                }
            });
            
            let currentSection;
            if (step === 1) {
                currentSection = document.getElementById('account-section');
            } else if (step === 2) {
                currentSection = document.getElementById('profile-section');
            } else if (step === 3) {
                currentSection = document.getElementById('package-section');
            } else if (step === 4) {
                currentSection = document.getElementById('payment-section');
            } else if (step === 5) {
                currentSection = document.getElementById('confirmation-section');
            }
            
            if (currentSection) {
                currentSection.style.display = 'block';
            }
            
            currentStep = step;
            updateProgressIndicator();
            window.scrollTo(0, 0);
        }
        
        function updateProgressIndicator() {
            document.querySelectorAll('.dot').forEach(dot => {
                dot.classList.remove('active', 'completed');
            });
            
            const progressLine = document.querySelector('.progress-line');
            if (progressLine) {
                const totalSteps = 5;
                const widthPercentage = ((currentStep - 1) / (totalSteps - 1)) * 100;
                progressLine.style.width = `${widthPercentage}%`;
            }
            
            for (let i = 1; i <= 5; i++) {
                const dot = document.getElementById(`dot-${i}`);
                if (dot) {
                    if (i < currentStep) {
                        dot.classList.add('completed');
                    } else if (i === currentStep) {
                        dot.classList.add('active');
                    }
                }
            }
        }

        // Add this to your registration page JavaScript
/* function checkRegistrationCap(type) {
    const capStatus = JSON.parse(localStorage.getItem('icsc_cap_status') || '{}');
    const caps = JSON.parse(localStorage.getItem('icsc_registration_caps') || '{}');
    const registrationStatus = localStorage.getItem('icsc_registration_status') || 'open';
    
    // Check if registration is closed
    if (registrationStatus === 'closed') {
        return {
            allowed: false,
            message: 'Registration is currently closed. Please check back later.'
        };
    }
    
    // Check specific type cap
    if (capStatus[type]) {
        const action = caps[type]?.action || 'disable';
        const message = caps.globalMessage || 'Registration for this category is currently full.';
        
        return {
            allowed: false,
            message: message,
            action: action
        };
    }
    
    return { allowed: true };
}

// Example usage in registration form:
document.getElementById('registrationForm').addEventListener('submit', function(e) {
    const capCheck = checkRegistrationCap('attendees'); // or 'speakers', 'exhibitors', 'partners'
    
    if (!capCheck.allowed) {
        e.preventDefault();
        alert(capCheck.message);
        
        if (capCheck.action === 'hide') {
            document.getElementById('registrationForm').style.display = 'none';
        } else if (capCheck.action === 'disable') {
            this.querySelectorAll('input, select, textarea, button').forEach(el => {
                el.disabled = true;
            });
        }
    }
}); */
        
        // PDF viewing functions
        function viewPartnerPackagePDF() {
            const pdfUrl = 'ICSC Sponsor Packages.pdf';
            window.open(pdfUrl, '_blank');
        }

        function downloadPartnerPackagePDF() {
            const pdfUrl = 'ICSC Sponsor Packages.pdf';
            const link = document.createElement('a');
            link.href = pdfUrl;
            link.download = 'ICSC Sponsor Packages.pdf';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        function showError(errorId, message) {
            const errorElement = document.getElementById(errorId);
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.style.display = 'block';
                
                const inputId = errorId.replace('-error', '');
                const inputElement = document.getElementById(inputId);
                if (inputElement) {
                    inputElement.classList.add('error');
                }
            }
        }
        
        function hideError(errorId) {
            const errorElement = document.getElementById(errorId);
            if (errorElement) {
                errorElement.style.display = 'none';
                
                const inputId = errorId.replace('-error', '');
                const inputElement = document.getElementById(inputId);
                if (inputElement) {
                    inputElement.classList.remove('error');
                }
            }
        }
    </script>
</body>
</html>